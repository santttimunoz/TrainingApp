<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>Archiving Storage Integration Detailed Flow</title>
    <link rel="StyleSheet" href="css/archiving-integration.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>PolicyCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="p-claims.html#2067069">Other Integration Topics</a> : <a class="WebWorks_Breadcrumb_Link" href="archiving-integration.38.1.html#2067069">Archiving Integration</a> : Archiving Storage Integration Detailed Flow</span></div>
    <hr align="left" />
    <blockquote>
      <h3 class="H1_-_Heading_1"><a name="2067069">Archiving Storage Integration Detailed Flow</a></h3>
      <div class="BKN_-_Body_002c_Keep_Next"><a name="2067073">PolicyCenter implements archive integration as a work queue.</a></div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="2067158">Archive Writers and Workers</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2130285">PolicyCenter performs the following archiving tasks to create archive writers and workers:</a></div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><a name="2131283">First, the application confirms that the network archive source system is available. It is possible that the archive source is unavailable due to network problems or configuration issues. The archive source plugin returns its status in its </a><span class="cv_-_computer_voice">getStatus</span> method. If the archive source is unavailable for any reason, then the writer work process logs an information message but does not create archive work items. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2131284">If the archive source is available, the batch process called Archiving Item Writer finds objects that are potentially eligible for archiving. The batch process creates a work item as a row in the database for every object that is eligible for archiving. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LP_-_List_Para"><a name="2198461">In PolicyCenter, from the work queue perspective, the eligible object for archiving is a policy term. However, a term contains potentially multiple </a><span class="cv_-_computer_voice">PolicyPeriod</span> objects and the <span class="cv_-_computer_voice">PolicyPeriod</span> is the physical unit of archiving.</div>
      <div class="LP_-_List_Para"><a name="2039009">The archive worker process performs all the following steps to process the archive items.</a></div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2039010">Each worker process performs eligibility checks on each work item. Some eligibility criteria is defined in internal code.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LP_-_List_Para"><a name="2198466">Before attempting archiving, PolicyCenter re-checks some criteria to see if it is eligible even if it already checked this when originally queuing the policy term. For example, an out of sequence job on the term now makes it ineligible even if that job did not exist when the term was queued for archive.</a></div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2130381">For each work item, PolicyCenter performs the following steps all within a single database transaction:</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LS2A_-_List_Start_002c_Level_2_Alpha_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LS2A_-_List_Start_002c_Level_2_Alpha_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS2A_-_List_Start_002c_Level_2_Alpha_inner"><a name="2198486">The worker calls the </a><span class="cv_-_computer_voice">IArchiveSource</span> plugin method <span class="cv_-_computer_voice">updateInfoOnStore</span>. It takes a single argument, which is a <span class="cv_-_computer_voice">PolicyPeriod</span> entity instance. In the plugin definition, this parameter is declared as an object that implements the <span class="cv_-_computer_voice">RootInfo</span> interface. If you need to add or modify properties on <span class="cv_-_computer_voice">PolicyPeriod</span> prior to archiving, set these properties in your <span class="cv_-_computer_voice">updateInfoOnStore</span> method.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI2A_-_List_Item_002c_Level_2_Alpha_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner"><a name="2198504">The worker determines the set of objects within the domain graph of this object. To accomplish this task, the worker </a><span class="e_-_emphasis">tags</span> the archived root object (the <span class="cv_-_computer_voice">PolicyPeriod</span>) specified in the work item. Next, worker recursively tags all entities in the domain graph whose parent object was tagged.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LP2_-_List_Para_002c_Level_2"><a name="2131371">The process of tagging includes setting the </a><span class="cv_-_computer_voice">ArchivePartition</span> property on the root object to a non-null value. The tagging process helps the application determine what data to delete at the end of the archiving process.</div>
      <div class="LI2A_-_List_Item_002c_Level_2_Alpha_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner"><a name="2198509">The worker internally generates a structure that represents an XML document for the archived </a><span class="cv_-_computer_voice">PolicyPeriod</span> and its subobjects.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI2A_-_List_Item_002c_Level_2_Alpha_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">d.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner"><a name="2068821">The worker serializes the XML structure into a stream of XML data as bytes. The worker outputs these bytes as an </a><span class="cv_-_computer_voice">java.io.InputStream</span> object.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI2A_-_List_Item_002c_Level_2_Alpha_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">e.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner"><a name="2198514">After archiving, PolicyCenter deletes most </a><span class="cv_-_computer_voice">PolicyPeriod</span> subobjects. However, PolicyCenter retains the <span class="cv_-_computer_voice">PolicyPeriod</span> entity instance and its associated entity instances of type <span class="cv_-_computer_voice">EffectiveDatedFields</span> and <span class="cv_-_computer_voice">Document</span>. Additionally, in certain circumstances certain other objects are retained, see <a href="javascript:WWHClickedPopup('integration', 'archiving-integration.38.2.html#1454238', '');" title="Overview of Archiving Integration">“Overview of Archiving Integration”</a> for details.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI2A_-_List_Item_002c_Level_2_Alpha_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">f.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner"><a name="2198522">The worker calls the archive source plugin </a><span class="cv_-_computer_voice">store</span> method. The first argument to the method is the input stream that contains the serialized XML document. The second argument is the <span class="cv_-_computer_voice">PolicyPeriod</span> object. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2131617">The worker commits the database transaction. This ends the database transaction for the preceding database changes. If any changes before this step threw an exception, all changes in this entire transaction are rolled back.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2039020">As the last step in the archive process for each work item, the worker calls the archive source plugin method </a><span class="cv_-_computer_voice">storeFinally</span>. PolicyCenter calls this method independent of whether the archive transaction succeeded. For example, if some code threw an exception and the archive transaction never committed, PolicyCenter still calls this method. Use this method to do any final clean up. To make any changes to entity data, you must run your Gosu code within a call to <span class="cv_-_computer_voice">Transaction.runWithNewBundle(block)</span>. That API sets up a bundle for your changes, and then commits the changes to the database in one transaction. For details, see <a href="javascript:WWHClickedPopup('gosu', 'transactions.22.11.html#1634152', '');" title="Running Code in an Entirely New Bundle">“Running Code in an Entirely New Bundle” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'transactions.22.11.html#1634152', '');" title="Running Code in an Entirely New Bundle">Gosu Reference Guide</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <h6 class="HS_-_Head_Sub"><a name="2040332">See also</a></h6>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a href="javascript:WWHClickedPopup('admin', 'batch.11.06.html#2166105', '');" title="Scheduling Work Queue Writers and Batch Processes" name="2040336">“Scheduling Work Queue Writers and Batch Processes” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('admin', 'batch.11.06.html#2166105', '');" title="Scheduling Work Queue Writers and Batch Processes">System Administration Guide</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a href="javascript:WWHClickedPopup('admin', 'batch.11.06.html#2166105', '');" title="Scheduling Work Queue Writers and Batch Processes" name="2040340">“Scheduling Work Queue Writers and Batch Processes” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('admin', 'batch.11.06.html#2166105', '');" title="Scheduling Work Queue Writers and Batch Processes">System Administration Guide</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="2040362">Error Handling During Archive</a></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2040363">If the archive process fails in any way, consult both of the following:</a></div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="2055968">Application logs</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="2085789">The </a><span class="ui_-_UI_element">Archive Info</span> page within the <span class="ui_-_UI_element">Server Tools</span> page.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LP_-_List_Para"><a name="2085791">To view the </a><span class="ui_-_UI_element">Archive Info</span> page, you must set the <span class="cv_-_computer_voice">config.xml</span> configuration parameter <span class="cv_-_computer_voice">ArchiveEnabled</span> to <span class="cv_-_computer_voice">true</span>.</div>
      <h4 class="H2_-_Heading_2"><a name="2038964">Archive Source Plugin Storage Methods</a></h4>
      <div class="BKN_-_Body_002c_Keep_Next"><a name="2070053">PolicyCenter calls various </a><span class="cv_-_computer_voice">IArchiveSource</span> methods during the archive store process. The following list of methods defines the main storage methods:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt; margin-bottom: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap; color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span class="cv_-_computer_voice"><a href="javascript:WWHClickedPopup('integration', 'archiving-integration.38.3.html#2038365', '');" title="Archiving Storage Integration Detailed Flow" name="2038351">prepareForArchive(info : RootInfo)</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt; margin-bottom: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap; color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span class="cv_-_computer_voice"><a href="javascript:WWHClickedPopup('integration', 'archiving-integration.38.3.html#2132035', '');" title="Archiving Storage Integration Detailed Flow" name="2038355">updateInfoOnStore(info : RootInfo)</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt; margin-bottom: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap; color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span class="cv_-_computer_voice"><a href="javascript:WWHClickedPopup('integration', 'archiving-integration.38.3.html#2133028', '');" title="Archiving Storage Integration Detailed Flow" name="2038359">store(graph : InputStream, info : RootInfo)</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt; margin-bottom: 2.0pt; vertical-align: baseline">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap; color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner" style="color: #000000; font-style: normal; font-variant: normal; font-weight: normal; text-transform: none"><span class="cv_-_computer_voice"><a href="javascript:WWHClickedPopup('integration', 'archiving-integration.38.3.html#2038396', '');" title="Archiving Storage Integration Detailed Flow" name="2038363">storeFinally(info : RootInfo, finalStatus : ArchiveFinalStatus, cause : List&lt;String&gt;)</a></span></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2198527">For PolicyCenter, when you see the interface type </a><span class="cv_-_computer_voice">RootInfo</span> in documentation or code in Studio, this always refers to a <span class="cv_-_computer_voice">PolicyPeriod</span> entity instance. </div>
      <h6 class="HS_-_Head_Sub"><span class="cvh_-_computer_voice_in_heading"><a name="2038365">prepareForArchive(info : RootInfo)</a></span> </h6>
      <div class="BKN_-_Body_002c_Keep_Next"><a name="2038366">The method call for </a><span class="cv_-_computer_voice">prepareForAchive</span> occurs outside the archive transaction. Thus:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2038370">PolicyCenter does not roll back any changes if the archiving operation fails.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2038371">PolicyCenter does not commit any changes automatically if the archiving operation succeeds.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2038372">You use this method for the (somewhat unusual) case in which you want to prepare some data regardless of whether the domain graph actually archives successfully. The method has no transaction of its own. If you want to update data, then you must create a bundle and commit that bundle yourself.</a></div>
      <div class="B_-_Body"><a name="2040522">In the demonstration plugin implementation, this method does nothing.</a></div>
      <h6 class="HS_-_Head_Sub"><span class="cvh_-_computer_voice_in_heading"><a name="2132035">updateInfoOnStore(info : RootInfo)</a></span> </h6>
      <div class="B_-_Body"><a name="2132048">PolicyCenter calls the </a><span class="cv_-_computer_voice">updateInfoOnStore</span> method after the application preps the data for archive but before calling the <span class="cv_-_computer_voice">store</span> method. Despite the name of the <span class="cv_-_computer_voice">updateInfoOnStore</span> method, this method is not the only place to modify the info object. See the following topic on the <span class="cv_-_computer_voice">store</span> method below. </div>
      <div class="B_-_Body"><a name="2132044">PolicyCenter calls this method inside the archiving transaction. This enables you to make additional updates on </a><span class="cv_-_computer_voice">RootInfo</span> objects.</div>
      <div class="B_-_Body"><a name="2132529">As the method call is inside the archiving transaction, if that transaction fails, then PolicyCenter does not commit any updates made during the call to the database.</a></div>
      <div class="B_-_Body"><a name="2132530">Depending on what kind of action you need to do in </a><span class="cv_-_computer_voice">updateInfoOnStore</span>, you might need similar or complementary changes in the plugin methods <span class="cv_-_computer_voice">updateInfoOnRetrieve</span> and <span class="cv_-_computer_voice">updateInfoOnDelete</span>.</div>
      <div class="B_-_Body"><a name="2091678">In the demonstration plugin implementation, this method does nothing.</a></div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="2198532">You can modify the root info object (</a><span class="cv_-_computer_voice">PolicyPeriod</span>) object in the <span class="cv_-_computer_voice">updateInfoOnStore</span> method. However, it is dangerous and unsupported to modify any other objects in the policy period graph in this method.</div>
      <h6 class="HS_-_Head_Sub"><span class="cvh_-_computer_voice_in_heading"><a name="2133028">store(graph : InputStream, info : RootInfo)</a></span> </h6>
      <div class="BKN_-_Body_002c_Keep_Next"><a name="2133100">The store method is the main configuration point for taking XML data (in the form of an </a><span class="cv_-_computer_voice">InputStream</span>) and transferring it to an external archive source system.</div>
      <div class="BKN_-_Body_002c_Keep_Next"><a name="2091684">PolicyCenter calls the </a><span class="cv_-_computer_voice">store</span> method inside the archiving transaction, after deleting rows from the database, but before performing the database commit. Your implementation of this method must store the archive XML document. </div>
      <div class="B_-_Body"><a name="2133462">During the method call, the archive process passes in the </a><span class="cv_-_computer_voice">java.io.InputStream</span> object that contains the generated XML document. This is the data that your archive source plugin must send to the external archive backing store.</div>
      <div class="B_-_Body"><a name="2038390">The archive process passes in the </a><span class="cv_-_computer_voice">RootInfo</span> object to the plugin so that it can insert or update additional reference information to help with restore. Generally speaking, this is not the best place to make changes to the root info object. Normally, it is best to make those changes in the <span class="cv_-_computer_voice">updateInfoOnStore</span> method.</div>
      <div class="B_-_Body"><a name="2094431">Generally speaking, it is best to change no entity data at all in the </a><span class="cv_-_computer_voice">store</span> method. Within the <span class="cv_-_computer_voice">store</span> method (or any other part of the data base transaction), the only properties that are safe to change are the non-array properties on the <span class="cv_-_computer_voice">RootInfo</span> object. The only safe reason to change entity data in the <span class="cv_-_computer_voice">store</span> method is to add a unique retrieval ID to an extension property on the <span class="cv_-_computer_voice">RootInfo</span> object. Only make this change from the <span class="cv_-_computer_voice">store</span> method if your external archive source requires this data for retrieval and that ID is only available after sending data.</div>
      <div class="BKN_-_Body_002c_Keep_Next"><a name="2133541">If your plugin is unable to store the XML document, then PolicyCenter expects the plugin to throw an error. PolicyCenter treats this error as a storage failure and rolls back the transaction. The transaction rollback also rolls back any changes to objects that you set up in your </a><span class="cv_-_computer_voice">updateInfoOnStore</span> method call.</div>
      <h6 class="HS_-_Head_Sub"><span class="cvh_-_computer_voice_in_heading"><a name="2038396">storeFinally(info : RootInfo, finalStatus : ArchiveFinalStatus, cause : List&lt;String&gt;)</a></span> </h6>
      <div class="B_-_Body"><a name="2095235">PolicyCenter calls this method outside the archiving transaction after completing that transaction. The </a><span class="p_-_parameter">finalStatus</span> parameter value indicates if the archiving delete operation was successful. Check this value. This allows the archive storage system to reverse any changes that were not part of the transaction in the rare case in which the delete transaction fails. </div>
      <div class="B_-_Body"><a name="2095252">To change any data, you must perform any entity instance modification within a call to </a><span class="cv_-_computer_voice">Transaction.runWithNewBundle(block)</span>. See <a href="javascript:WWHClickedPopup('gosu', 'transactions.22.11.html#1634152', '');" title="Running Code in an Entirely New Bundle">“Running Code in an Entirely New Bundle” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'transactions.22.11.html#1634152', '');" title="Running Code in an Entirely New Bundle">Gosu Reference Guide</a></span>.</div>
      <div class="B_-_Body"><a name="2095257">If this method is called with errors, </a><span class="cv_-_computer_voice">finalStatus</span> is something other than <span class="cv_-_computer_voice">success</span>. The cause parameter contains a list of <span class="cv_-_computer_voice">String</span> objects that describe the cause of any failures. The <span class="cv_-_computer_voice">String</span> objects are the text for the exception cause hierarchy. </div>
      <div class="B_-_Body"><a name="2095319">This permits two different design strategies:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2116489">The recommended technique is to send and commit your data in the external source in the </a><span class="cv_-_computer_voice">store</span> method. On failure conditions, in <span class="cv_-_computer_voice">storeFinally</span> you can back out of any changes in the external data store. For example, delete any temporarily-created files.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="2116490">Alternatively, you can perform a two stage commit. In other words, send the data to the external system in the </a><span class="cv_-_computer_voice">store</span> method but finalize it in <span class="cv_-_computer_voice">storeFinally</span> if and only if <span class="cv_-_computer_voice">finalStatus</span> indicates success.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2095718">It is important to be careful about what kinds of work you do in the </a><span class="cv_-_computer_voice">storeFinally</span> method to properly handle error conditions. If the <span class="cv_-_computer_voice">storeFinally</span> method throws an exception, the application logs the exception but the main database transaction already completed. Be sure to carefully catch any exception and handle all error conditions. There is no rollback or recovery that the application can perform if <span class="cv_-_computer_voice">storeFinally</span> does not complete its actions due to errors or exceptions within the <span class="cv_-_computer_voice">storeFinally</span> implementation.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>