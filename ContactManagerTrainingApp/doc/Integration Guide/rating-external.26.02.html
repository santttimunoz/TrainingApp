<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>The Rating Framework</title>
    <link rel="StyleSheet" href="css/rating-external.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>PolicyCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="p-forms.html#3051019">Policy-related Integrations</a> : <a class="WebWorks_Breadcrumb_Link" href="rating-external.26.01.html#3051019">Rating Integration</a> : The Rating Framework</span></div>
    <hr align="left" />
    <blockquote>
      <h3 class="H1_-_Heading_1"><a name="3051019">The Rating Framework</a></h3>
      <div class="B_-_Body"><a name="3051020">PolicyCenter job workflows quantify the financial implications (the cost to the insured) from each job. Of course, submission jobs and policy change jobs have financial implications. In addition, other job types generate financial implications for the insured:</a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3050875">Costs for renewals, such as renewal prices</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3050886">Costs for cancellations, such as refunds or cancellation charges</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3050895">The entire process of offering a policy with a set of terms to an insured at a particular price is called </a><span class="e_-_emphasis">quoting</span>. Quoting includes the following steps:</div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><a name="3017612">Collect data about what the insured wants.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3017622">Validate the policy data.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3017629">Decide whether the policy requires underwriting approval.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3032204">Obtain costs or a set of costs for policy coverage for the insured. This step is called </a><span class="e_-_emphasis">rating</span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3050956">Finally, display the quote to the agent or customer.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3050982">This topic primarily discusses rating (</a><a href="javascript:WWHClickedPopup('integration', 'rating-external.26.02.html#3032204', '');" title="The Rating Framework">step 4</a> in the previous numbered list). This topic discusses how to integrate your own rating code into PolicyCenter. For a general overview of the quoting process in the user interface, see <a href="javascript:WWHClickedPopup('app', 'rating.44.01.html#1014525', '');" title="Quoting and Rating">“Quoting and Rating” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('app', 'rating.44.01.html#1014525', '');" title="Quoting and Rating">Application Guide</a></span>.</div>
      <div class="B_-_Body"><a name="3050983">Many rating costs correspond to a specific object or coverage, for example a personal auto coverage. Costs can also represent taxes and surcharges that apply across an entire policy period. Costs can represent entire policies, in the case of umbrella coverage policies.</a></div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="3016736">The rest of this topic uses terminology of the PolicyCenter policy revisioning system. For important discussion about these concepts, see </a><a href="javascript:WWHClickedPopup('app', 'policyrevisions.52.01.html#2556048', '');" title="Policy Revisioning">“Policy Revisioning” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('app', 'policyrevisions.52.01.html#2556048', '');" title="Policy Revisioning">Application Guide</a></span>. In particular, see the topic <a href="javascript:WWHClickedPopup('app', 'policyrevisions.52.03.html#2692659', '');" title="Structure of Revisioning Across Effective Time">“Structure of Revisioning Across Effective Time” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('app', 'policyrevisions.52.03.html#2692659', '');" title="Structure of Revisioning Across Effective Time">Application Guide</a></span>.</div>
      <div class="B_-_Body"><a name="3012139">When PolicyCenter needs to rate a policy, it calls the registered implementation of the rating plugin interface (</a><span class="cv_-_computer_voice">IRatingPlugin</span>) to rate the policy. The rating plugin is the main entry point to the rating process. </div>
      <div class="B_-_Body"><a name="3046902">To write your own code that rates policies, your main task is to implement the rating plugin, or modify the built-in implementation that PolicyCenter includes. The built-in implementation of the rating plugin is the Gosu class </a><span class="cv_-_computer_voice">gw.plugin.policyperiod.impl.SysTableRatingPlugin</span>. It uses other related classes such as <span class="cv_-_computer_voice">AbstractRatingEngine</span> and <span class="cv_-_computer_voice">CostData</span>. This documentation refers collectively to the rating plugin implementation its various related classes as the <span class="e_-_emphasis">default rating engine</span>. Review the built-in code to more deeply understand the default behavior of this rating engine.</div>
      <div class="B_-_Body"><a name="3093262">If you use Guidewire Rating Management, you use a different built-in plugin implementation class. For details, see </a><a href="javascript:WWHClickedPopup('integration', 'rating-external.26.03.html#3093354', '');" title="Guidewire Rating Management and PCRatingPlugin">“Guidewire Rating Management and PCRatingPlugin”</a>.</div>
      <div class="NI_-_Note_Important">
        <span class="n_-_note">IMPORTANT   </span><a name="3198149">To determine whether your Guidewire PolicyCenter license agreement includes Guidewire Rating Management, contact your Guidewire sales representative. Rating Management requires an additional license key. For instructions on obtaining and installing this key, contact your Guidewire support representative.</a></div>
      <div class="B_-_Body"><a name="3012367">Any rating plugin implementation must perform two main tasks:</a></div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><a name="3012193">Alter the set of costs (cost entity instances) in the policy entity graph. The rating plugin has only one method. When the method returns, the branch must contain the correct set of cost objects that represent pricing for the entire policy period. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="3012587">PolicyCenter later reads the cost information and creates onset and offset transactions. PolicyCenter sends the onset and offset transactions to your billing system.</a></div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="3072460">Notify PolicyCenter that the full set of cost information (the quote) is complete and valid. If there are errors, the plugin marks it as invalid. The default rating engine code marks the quote valid by default. If the default rating code catches any exceptions, it logs the error and marks the quote invalid. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="NW_-_Note_Warning">
        <span class="w_-_warning">WARNING  </span><a name="3012704">The default rating engine contains code to force a failed quote for certain test cases. If you use the built-in rating plugin, remove that code before pushing your code to a production system. Look in </a><span class="cv_-_computer_voice">SysTableRatingPlugin.gs</span> in the <span class="cv_-_computer_voice">ratePeriodImpl</span> method.</div>
      <div class="B_-_Body"><a name="3065562">You might make only minor changes to the built-in rating plugin implementation. Most of the rating code for typical carriers are in separate rating engine classes for each line of business. Each line-specific rating engine extends the abstract rating engine class (</a><span class="cv_-_computer_voice">AbstractRatingEngine</span>). Additionally, consider encapsulating your actual algorithm into separate Gosu classes, one for each type of premium. For how to write your rating algorithm, including table lookups, see <a href="javascript:WWHClickedPopup('integration', 'rating-external.26.16.html#3060174', '');" title="Writing Your Own Line-specific Rating Engine Subclass">“Coding Your Actual Rating Algorithm”</a>.</div>
      <div class="B_-_Body"><a name="3013759">To modify rating for a built-in line of business, modify the built-in rating engine class or create a new subclass based on the built-in class.</a></div>
      <div class="B_-_Body"><a name="3065581">To rate a new line of business, create a new subclass of </a><span class="cv_-_computer_voice">AbstractRatingEngine</span> that handles that line of business. If you create any new rating engine subclasses, you must also change the rating plugin method that instantiates and initializes the rating engine subclass based on the line of business. Do not forget to add that code.</div>
      <div class="B_-_Body"><a name="3012566">The built-in rating engine general algorithm is the following:</a></div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><span class="ri_-_run_in_header"><a name="3012567">Find all change dates in the policy</a></span> – First, find all dates on which anything changes in the policy in that branch. These are also known as slice dates.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="3065596">For information about slice mode and related revisioning concepts, refer to </a><a href="javascript:WWHClickedPopup('app', 'policyrevisions.52.03.html#2692659', '');" title="Structure of Revisioning Across Effective Time">“Structure of Revisioning Across Effective Time” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('app', 'policyrevisions.52.03.html#2692659', '');" title="Structure of Revisioning Across Effective Time">Application Guide</a></span>.</div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><span class="ri_-_run_in_header"><a name="3015287">Traverse down the graph on each slice date</a></span> – For each date on which anything changes, traverse the policy graph downward from its root and calculate costs for this slice date. Each cost represents the cost of everything that can be rated in slice mode for that date. In PolicyCenter revisioning terminology, slice mode is a way of looking at a policy from a specific point in effective time. The abstract rating engine class automatically handles the date detection and revisioning logic associated with this step.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><span class="ri_-_run_in_header"><a name="3071792">Calculate costs for each slice for every rating line</a></span> – The abstract rating engine class next calculates the costs for the policy as it exists in effective time between the current slice date and the next slice date. However, costs generated in this step are not yet prorated. The rating engine works this way because it is a common design pattern to integrate with existing rating engines. Suppose an insured requests a policy change to be effective three days before the end of the policy period. The change adds five vehicles to the policy and it is the last change of the policy period in effective time. For this last slice date, the rating engine calculates the policy cost with new vehicles as if they were for the whole period, not just three days. During this step, each rating line sets some cost data properties, including effective and expiration dates based on the time between the current slice date and the next slice date. For a reference of cost properties, including which ones are required to set, see <a href="javascript:WWHClickedPopup('integration', 'rating-external.26.10.html#2983434', '');" title="Cost Core Properties">“Cost Core Properties”</a>. This is the step in which you might call out to an external rating engine. Be aware that the default rating engine assumes the rating engine responds synchronously. To implement asynchronous rating instead, see <a href="javascript:WWHClickedPopup('integration', 'rating-external.26.07.html#3047823', '');" title="Optional Asynchronous Rating">“Optional Asynchronous Rating”</a>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="3072083">This is the critical part of your rating code for costs that make sense in slice&nbsp;mode. Consider encapsulating your actual algorithm into separate Gosu classes, one for each type of premium. For how to write your rating algorithm, including table lookups, see </a><a href="javascript:WWHClickedPopup('integration', 'rating-external.26.16.html#3060174', '');" title="Writing Your Own Line-specific Rating Engine Subclass">“Coding Your Actual Rating Algorithm”</a>.</div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	4.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><span class="ri_-_run_in_header"><a name="3013657">Combine costs for all slices and prorate the costs</a></span> – PolicyCenter merges any costs if two costs match all of the following: </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="3022287">Costs are for the same type of premium, such as the same type of cost for the same car and same coverage</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="3022300">Costs are adjacent in effective time</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI2_-_Bullet_Item_002c_Level_2_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI2_-_Bullet_Item_002c_Level_2_inner"><a name="3022307">Costs have the same rating result, in other words the same non-prorated premium and same rate</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LP_-_List_Para"><a name="3022320">Next, the rating engine prorates slice mode costs based on the cost effective and expiration date properties set in the previous step. PolicyCenter skips costs that already have an actual amount in its </a><span class="cv_-_computer_voice">ActualAmount</span> property because that means that the rating engine already prorated it. The abstract rating engine class automatically handles date detection and revisioning logic associated with this step. For more about the proration algorithm, see <a href="javascript:WWHClickedPopup('integration', 'rating-external.26.06.html#3047966', '');" title="Common Questions About the Default Rating Engine">“Is Proration Always Linear?”</a>.</div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	5.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><span class="ri_-_run_in_header"><a name="3069651">Calculate costs that depend on previous steps (window mode costs)</a></span> – Next, the line-specific rating engine rates the costs that apply to the entire policy period. For example, many types of discounts and taxes depend on getting sums of the slice-mode costs. If you support flat-rated costs, calculate them in this step. For more information about flat-rated costs, see <a href="javascript:WWHClickedPopup('app', 'rating.44.04.html#12009199', '');" title="Cost Delegate">“Cost Delegate” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('app', 'rating.44.04.html#12009199', '');" title="Cost Delegate">Application Guide</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="3072071">This is the critical part of rating code for costs that make sense only as calculations using period-wide subtotals. Consider encapsulating your actual algorithm into separate Gosu classes, one for each type of premium. For how to write your rating algorithm, including table lookups, see </a><a href="javascript:WWHClickedPopup('integration', 'rating-external.26.16.html#3060174', '');" title="Writing Your Own Line-specific Rating Engine Subclass">“Coding Your Actual Rating Algorithm”</a>.</div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	6.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><span class="ri_-_run_in_header"><a name="3022499">Convert rating results into cost entity instances</a></span> – The rating engine must adjust the rows in the database to match the rating results. Up until this step, all the rating happens on <span class="e_-_emphasis">cost data objects</span> (<span class="cv_-_computer_voice">CostData</span> objects). Cost data objects are non-entity class instances that mirror the role of actual <span class="cv_-_computer_voice">Cost</span> entity instances. There are subclasses of <span class="cv_-_computer_voice">CostData</span> for each cost type, effectively mirroring the various line-of-business-specific subtypes of the <span class="cv_-_computer_voice">Cost</span> entity. For more information, see <a href="javascript:WWHClickedPopup('integration', 'rating-external.26.04.html#3109522', '');" title="Overview of Cost Data Objects">“Overview of Cost Data Objects”</a>. There are several parts of this conversion process:</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LS2A_-_List_Start_002c_Level_2_Alpha_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LS2A_-_List_Start_002c_Level_2_Alpha_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">a.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS2A_-_List_Start_002c_Level_2_Alpha_inner"><span class="ri_-_run_in_header"><a name="3048992">Update reusable cost entity instances</a></span> – If the rating engine can reuse an existing cost entity instance, the rating engine updates the cost to match an updated cost data object. The rating engine updates the cost’s effective/expiration dates, all the rating-related properties, and all amount-related properties. The rating engine sets the properties in the cost entity instance to the values in the cost data object.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI2A_-_List_Item_002c_Level_2_Alpha_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">b.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner"><span class="ri_-_run_in_header"><a name="3048993">Create new cost entity instances if necessary</a></span> – If the rating engine cannot find an existing cost entity instance for this cost, the rating engine creates a new cost. Generally speaking, this means that there is no cost that matches the cost’s key values and is effective on the effective date of the cost data. For more information about key&nbsp;values, see <a href="javascript:WWHClickedPopup('integration', 'rating-external.26.13.html#3037569', '');" title="Cost Data Object Methods and Constructors to Override">“Key Values for Each Cost Data Subclass”</a>. The rating engine then adds a new cost by cloning an existing cost entity instance that matches on its same cost key but for different effective dates. This ensures that the new cost entity instance shares the same version list because they have the same fixed ID value.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI2A_-_List_Item_002c_Level_2_Alpha_outer" style="margin-left: 67pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">c.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI2A_-_List_Item_002c_Level_2_Alpha_inner"><span class="ri_-_run_in_header"><a name="3048974">Delete untouched cost entity instances</a></span> – Cost entity instances from previous rating requests may no longer be relevant. For example, if you rate a policy and then remove a coverage, costs for that coverage no longer apply. If any cost entity instances do not match any cost data objects in the recent rating request, the default rating engine deletes the cost entity instances. Before rating begins, the rating engine makes a temporary list containing all cost entities for this policy. As the rating engine converts rating results into <span class="cv_-_computer_voice">Cost</span> entity instances, it removes any updated (reused) entities from the list. After the rating engine iterates across all cost data objects, any cost entity instances still in this list match no cost data objects in the current request. The relevant Gosu code refers to this as the <span class="e_-_emphasis">untouched&nbsp;list</span> of costs. The rating engine removes all entities in that list.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3011916">This general algorithm works for typical lines of business, and generally speaking results in easy-to-maintain and easy-to-understand code. It also helps that for slice mode changes, the abstract rating engine class handles the more complex parts of revisioning (date detection, cost merging, prorating) automatically.</a></div>
      <div class="B_-_Body"><a name="3013521">Some lines of business are ill-suited to this approach, however. For example, in the United States for workers’ compensation, regulators mandate a certain rating algorithm that varies greatly from the way most other lines of business generate costs. For alternative rating strategies, see </a><a href="javascript:WWHClickedPopup('integration', 'rating-external.26.19.html#3049413', '');" title="Rating Variations">“Rating Variations”</a>.</div>
      <h6 class="HS_-_Head_Sub"><a name="3069740">See also</a></h6>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3069820">For how the default rating engine uses cost data objects, see </a><a href="javascript:WWHClickedPopup('integration', 'rating-external.26.04.html#3109522', '');" title="Overview of Cost Data Objects">“Overview of Cost Data Objects”</a>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3069876">For where to add your main rating code, see </a><a href="javascript:WWHClickedPopup('integration', 'rating-external.26.05.html#3002871', '');" title="Where to Override the Default Rating Engine?">“Where to Override the Default Rating Engine?”</a>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3003181">For a feature-level overview of quoting, see </a><a href="javascript:WWHClickedPopup('app', 'rating.44.14.html#12009143', '');" title="Calculating Transactions">“Calculating Transactions” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('app', 'rating.44.14.html#12009143', '');" title="Calculating Transactions">Application Guide</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3069753">For data model entities for each line of business, see </a><a href="javascript:WWHClickedPopup('app', 'rating.44.03.html#12009154', '');" title="Entities Associated with Costs and Transactions">“Entities Associated with Costs and Transactions” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('app', 'rating.44.03.html#12009154', '');" title="Entities Associated with Costs and Transactions">Application Guide</a></span>.</div>
            </td>
          </tr>
        </table>
      </div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>