<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>A Close Look at PersonalAutoCovCostData</title>
    <link rel="StyleSheet" href="css/rating-external.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
    <!-- THE FOLLOWING IS A GUIDEWIRE STYLE DEFINITION FOR THE LINK TO THIS FEATURE -->
    <link rel="StyleSheet" href="css/css-guidewire-extra.css" type="text/css" media="all" />
    <!-- THE FOLLOWING IS A GUIDEWIRE GSCRIPT FUNCTION FOR THE LINK TO THIS FEATURE -->
    <script type="text/javascript">
function guidewire_selectall()
{
var text_val=eval("document.linktothisurlform.urlfield");
text_val.focus();
text_val.select();
}
</script>
  </head>
  <body onLoad="WWHUpdate();" onUnload="WWHUnload();" onKeyDown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onKeyPress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onKeyUp="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <!-- THE FOLLOWING IS A GUIDEWIRE DIV FOR THE 'LINK TO THIS' FEATURE -->
    <div id="linkToThisPage" class="popup" style="display: none;">
      <div class="popupTitle">Link Directly to This Page 
           <a href="#" onclick="var thePopup = getElementById('linkToThisPage');thePopup.style.display='none';return false;"><img class="popupClosebox" src="wwhelp/wwhimpl/common/images/close.gif" /></a></div>
      <div style="padding:6px;">
        <div class="popupText" id="linkToThisPageBookmark">An error has occurred if you see this messsage.</div>
        <form name="linktothisurlform" method="post" action="" style="width:275px;margin:0px">
          <input type="text" class="popupURLText" id="linkToThisPageURL" name="urlfield" rows="1" cols="55" onClick="guidewire_selectall();" onFocus="guidewire_selectall();"></input>
        </form>
      </div>
    </div>
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <span>PolicyCenter Integration Guide</span> : 
    <span class="WebWorks_Breadcrumbs" style="text-align: left;"><a class="WebWorks_Breadcrumb_Link" href="p-forms.html#3146039">Policy-related Integrations</a> : <a class="WebWorks_Breadcrumb_Link" href="rating-external.26.01.html#3146039">Rating Integration</a> : <a class="WebWorks_Breadcrumb_Link" href="rating-external.26.17.html#3146039">Rating Line Example for Personal Auto</a> : A Close Look at PersonalAutoCovCostData</span></div>
    <hr align="left" />
    <blockquote>
      <h4 class="H2B_-_Heading_2_Break"><a name="3146039">A Close Look at </a><span class="cvh_-_computer_voice_in_heading">PersonalAutoCovCostData</span></h4>
      <div class="B_-_Body"><a name="3065135">Look at the methods on the </a><span class="cv_-_computer_voice">gw.lob.pa.rating.PersonalAutoCovCostData</span> class, which is the most complex of the personal auto cost data objects. It extends the <span class="cv_-_computer_voice">PACostData</span> class, parameterized on the corresponding entity type <span class="cv_-_computer_voice">PersonalAutoCovCost</span>. The class declares its superclass in Gosu generics syntax as follows:</div>
      <div class="CS_-_Code_Single_Line"><a name="2983555">class PersonalAutoCovCostData extends PACostData&lt;PersonalAutoCovCost&gt; { </a></div>
      <div class="B_-_Body"><a name="3051140">The angle bracket notation indicates use of Gosu generics. This particular example means that we want the </a><span class="cv_-_computer_voice">PACostData</span> generic class to work with the class <span class="cv_-_computer_voice">PersonalAutoCovCost</span>. This allows the definition of <span class="cv_-_computer_voice">PACostData</span> to be written in a general way to work with lots of types of data, but be typesafe at compile time. Some of the rating code uses this parameter to determine which <span class="cv_-_computer_voice">Cost</span> entity subtype to create. For more information about generics, see <a href="javascript:WWHClickedPopup('gosu', 'generics.19.1.html#1455314', '');" title="Gosu Generics">“Gosu Generics” in the </a><span class="bt_-_book_title"><a href="javascript:WWHClickedPopup('gosu', 'generics.19.1.html#1455314', '');" title="Gosu Generics">Gosu Reference Guide</a></span>.</div>
      <div class="B_-_Body"><a name="2991497">The class contains properties for the vehicle’s </a><span class="cv_-_computer_voice">FixedId</span> property and the coverage’s <span class="cv_-_computer_voice">FixedId</span> property. These fixed IDs are encapsulated in a <span class="cv_-_computer_voice">Key</span> object:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983560"> var _vehicleID : Key</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983561"> var _covID : Key</a></PRE>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="3064741">For more about fixed ID </a><span class="cv_-_computer_voice">Key</span> objects, see <a href="javascript:WWHClickedPopup('integration', 'rating-external.26.09.html#3070370', '');" title="What Do Cost Data Objects Contain?">“What Do Cost Data Objects Contain?”</a> and <a href="javascript:WWHClickedPopup('integration', 'rating-external.26.12.html#3066089', '');" title="Fixed ID Keys Link a Cost Data Object to Another Object">“Fixed ID Keys Link a Cost Data Object to Another Object”</a>.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3065014">Constructors for </a><span class="cvh_-_computer_voice_in_heading">PersonalAutoCovCostData</span></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3065020">The standard constructor initializes these properties. The constructor also ensures that the fixed ID </a><span class="cv_-_computer_voice">Key</span> objects passed to the constructor have the proper type. This avoids errors like switching the order of the arguments:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="3065015"> construct(effDate : Date, expDate : Date, vehicleIDArg : Key, covIDArg : Key) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983566">   super(effDate, expDate)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983567">   assertKeyType(vehicleIDArg, PersonalVehicle)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983568">   assertKeyType(covIDArg, PersonalAutoCov)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983569">   _vehicleID = vehicleIDArg</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983570">   _covID = covIDArg</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983571"> }</a></PRE>
      <div class="B_-_Body"><a name="2983573">There is an alternate constructor that populates a cost data object based on an existing </a><span class="cv_-_computer_voice">Cost</span> row. The superclass constructor does most of the work. This version just needs to extract out subtype-specific properties, in this case the vehicle and coverage fixed ID <span class="cv_-_computer_voice">Key</span> objects:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983575"> construct(c : PersonalAutoCovCost) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983576">   super(c)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983577">   _vehicleID = c.PersonalVehicle.FixedId</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983578">   _covID = c.PersonalAutoCov.FixedId </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983579"> }</a></PRE>
      <div class="B_-_Body"><a name="3068395">For more information about cost data constructors, see </a><a href="javascript:WWHClickedPopup('integration', 'rating-external.26.13.html#3037022', '');" title="Cost Data Object Methods and Constructors to Override">“Constructors for a Cost Data Subclass”</a></div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3064998">Set Specific Properties on Cost for </a><span class="cvh_-_computer_voice_in_heading">PersonalAutoCovCostData</span></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2983581">The cost data </a><span class="cv_-_computer_voice">setSpecificFieldsOnCost</span> method needs to populate the line-specific (non-core) properties. For important details about this method and how to implement it, see <a href="javascript:WWHClickedPopup('integration', 'rating-external.26.13.html#3037061', '');" title="Cost Data Object Methods and Constructors to Override">“Copying Custom Properties from Cost Data Objects to Cost Entity Instances”</a>. Another related discussion is <a href="javascript:WWHClickedPopup('integration', 'rating-external.26.12.html#3066089', '');" title="Fixed ID Keys Link a Cost Data Object to Another Object">“Fixed ID Keys Link a Cost Data Object to Another Object”</a>.</div>
      <div class="B_-_Body"><a name="3045555">The </a><span class="cv_-_computer_voice">setSpecificFieldsOnCost</span> method first calls out to the superclass version, then sets the coverage and vehicle IDs. This code calls the <span class="cv_-_computer_voice">setFieldValue</span> method using the fixed ID Key object. Foreign keys on effective-dated (revisionable) entities store the value of the <span class="cv_-_computer_voice">FixedId</span> of the referenced entity. The alternative is to try to find an actual reference to the entity in question by traversing all over the entity graph, which would be resource-intensive and error-prone. Thus, calling <span class="cv_-_computer_voice">setFieldValue</span> is the easiest approach. </div>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="3066444">See </a><a href="javascript:WWHClickedPopup('integration', 'rating-external.26.13.html#3037061', '');" title="Cost Data Object Methods and Constructors to Override">“Copying Custom Properties from Cost Data Objects to Cost Entity Instances”</a> for more details about <span class="cv_-_computer_voice">setFieldValue</span>.</div>
      <div class="B_-_Body"><a name="3064954">In the policy auto line, the </a><span class="cv_-_computer_voice">setSpecificFieldsOnCost</span> method looks like:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983583"> override function setSpecificFieldsOnCost(line : PersonalAutoLine, </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2992254">&nbsp;&nbsp;&nbsp;&nbsp;cost : PersonalAutoCovCost) : void {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983584">   super.setSpecificFieldsOnCost(line, cost)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983585">   cost.setFieldValue( "PersonalAutoCov", _covID )  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983586">   cost.setFieldValue( "PersonalVehicle", _vehicleID )      </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983587"> }</a></PRE>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3064965">Versioned Costs for </a><span class="cvh_-_computer_voice_in_heading">PersonalAutoCovCostData</span></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2983589">Probably the most complicated method to implement on </a><span class="cv_-_computer_voice">CostData</span> objects is the <span class="cv_-_computer_voice">getVersionedCosts</span> method. It finds the <span class="cv_-_computer_voice">VersionList</span>, if any, of the existing cost on the coverage that points to this vehicle. Since it has only the fixed ID of the coverage, rather than an actual <span class="cv_-_computer_voice">PersonalAutoCov</span> object, it cannot call <span class="cv_-_computer_voice">_cov.VersionList</span>. However, this code can construct a <span class="cv_-_computer_voice">VersionList</span> object based on the branch and the fixed ID of the <span class="cv_-_computer_voice">Coverage</span>. </div>
      <div class="B_-_Body"><a name="3064870">To do this, use the </a><span class="cv_-_computer_voice">EffDatedUtil.createVersionList(...)</span> method. The resulting version list is typed to the root type of all version lists. Thus, the code casts it as the more specific type, <span class="cv_-_computer_voice">PersonalAutoCovVersionList</span>. Next, the code gets the <span class="cv_-_computer_voice">List</span> of cost version lists, and finds the one (if any) that corresponds to the vehicle in question:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983591"> override function getVersionedCosts(line : PersonalAutoLine) :</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2992265">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;com.guidewire.commons.entity.effdate.EffDatedVersionList&gt; {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983592">   var covVL = EffDatedUtil.createVersionList( line.Branch, _covID ) as PersonalAutoCovVersionList</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983593">   return covVL.Costs.where(\ costVL -&gt; isCostVersionListForVehicle(costVL)).toList()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983594"> }</a></PRE>
      <div class="B_-_Body"><a name="3065299">In this case, the method calls a private method called </a><span class="cv_-_computer_voice">isCostVersionListForVehicle</span> to do most of the work. To determine if a given <span class="cv_-_computer_voice">PersonalAutoCovCostVersionList</span> applies to this vehicle, it looks at the first (chronological) version and check the <span class="cv_-_computer_voice">FixedId</span> of its associated <span class="cv_-_computer_voice">Vehicle</span>:</div>
      <PRE class="CF_-_Code_First_Line"><a name="3065300"> private function isCostVersionListForVehicle(</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3065301">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;costVL : entity.windowed.PersonalAutoCovCostVersionList) : boolean {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3065302">   var firstVersion = costVL.AllVersions.first()</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="3065303">   return firstVersion typeis PersonalAutoCovCost and firstVersion.Vehicle.FixedId == _vehicleID</a></PRE>
      <PRE class="CL_-_Code_Last_Line"><a name="3065304"> }</a></PRE>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="3065359">For more discussion on this pattern and the </a><span class="cv_-_computer_voice">isCostVersionListForVehicle</span> method, See <a href="javascript:WWHClickedPopup('integration', 'rating-external.26.13.html#3037061', '');" title="Cost Data Object Methods and Constructors to Override">“Copying Custom Properties from Cost Data Objects to Cost Entity Instances”</a>.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="3065262">Key Values for </a><span class="cvh_-_computer_voice_in_heading">PersonalAutoCovCostData</span></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3065263">The key values for this cost are just the vehicle and coverage ID:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983598"> protected override property get KeyValues() : List&lt;Object&gt; {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983599">   return {_vehicleID, _covID}</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983600"> }</a></PRE>
      <div class="N_-_Note">
        <span class="n_-_note">Note: </span><a name="3064943">See </a><a href="javascript:WWHClickedPopup('integration', 'rating-external.26.13.html#3037569', '');" title="Cost Data Object Methods and Constructors to Override">“Key Values for Each Cost Data Subclass”</a>. </div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="2983610">Rate Slice Details for </a><span class="cvh_-_computer_voice_in_heading">PersonalAutoCovCostData</span></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2983612">The </a><span class="cv_-_computer_voice">PASysTableRatingEngine</span> class implements the <span class="cv_-_computer_voice">rateSlice</span> method with the following general algorithm. The structure is similar to other lines of business:</div>
      <div class="LS_-_List_Start_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LS_-_List_Start_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	1.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LS_-_List_Start_inner"><a name="2983614">If the slice is canceled, do nothing.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	2.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2983615">Otherwise, loop across the line-level coverages. Within that loop, loop over each vehicle and rate the combination of that line-level coverage and the vehicle.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="LI_-_List_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="LI_-_List_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="ri_-_run_in_header">	3.	</span>
              </div>
            </td>
            <td width="100%">
              <div class="LI_-_List_Item_inner"><a name="2983617">Loop over each vehicle. Within that loop, loop over each coverage on the vehicle and rate the coverage.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2983620">Since the argument passed to the </a><span class="cv_-_computer_voice">rateSlice</span> method is already sliced as of the appropriate effective date, the slice rating code is simple. It does not need complex code to determine effective dates. It can just traverse the graph in the normal straightforward way.</div>
      <div class="B_-_Body"><a name="2983622">It might be useful to see more details of rating of one of the coverages. In this case, let us look at the standard collision coverage. The </a><span class="cv_-_computer_voice">rateSlice</span> method calls to <span class="cv_-_computer_voice">rateVehicleCoverage</span> for each coverage on a vehicle:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983624"> private function rateVehicleCoverage(cov : PersonalVehicleCov) : PersonalVehicleCovCostData {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983625">   assertSliceMode(cov)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983626">   switch (typeof cov) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983627">     case PACollisionCov: return ratePACollisionCov(cov)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983628">     case PAComprehensiveCov: return ratePAComprehensiveCov(cov)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983629">     case PARentalCov: return ratePARentalCov(cov)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983630">     case PATowingLaborCov: return ratePATowingLaborCov(cov)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983631">     default:</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983632">       PCFinancialsLogger.logDebug("Not rating ${(typeof cov)}")  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983633">       return null  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983634">   }</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983635"> }</a></PRE>
      <div class="B_-_Body"><a name="2983637">The </a><span class="cv_-_computer_voice">switch</span> statement using the type of the coverage is a fairly standard pattern in the built-in rating code, within the <span class="cv_-_computer_voice">rateSlice</span> method of a line-specific rating engine.</div>
      <div class="B_-_Body"><a name="2991783">Let us now look at the rating code for the personal auto collision coverage:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983639"> private function ratePACollisionCov(cov : PACollisionCov) : PersonalVehicleCovCostData {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983640">   var ratingDate = _referenceDatePlugin.getCoverageReferenceDate(</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2992280">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cov.Pattern as CoveragePattern, cov.PersonalVehicle)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983641">   var baseRate = getRateFactor("papCollRate", "base", ratingDate )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983642">   var adjRate = baseRate</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983643">&nbsp;&nbsp;&nbsp;* getRateFactor("papCollDeductible", cov.PACollDeductibleTerm.OptionValue.OptionCode, ratingDate )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983644">&nbsp;&nbsp;&nbsp;* getAgeFactor(cov.PersonalVehicle, ratingDate)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983645">&nbsp;&nbsp;&nbsp;* getRateFactorInRange("papVehicleCostNew", cov.PersonalVehicle.CostNew as double, cov, ratingDate )</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983646">&nbsp;&nbsp;&nbsp;* getDriverRatingFactor(cov.PersonalVehicle, ratingDate)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2984289">&nbsp;&nbsp;&nbsp;* getNoLossDiscountFactor(cov.PersonalVehicle.PALine, ratingDate)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2984290">&nbsp;&nbsp;&nbsp;* getUWCompanyRateFactor(cov.PersonalVehicle.PALine)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2984291">   return rateVehicleCoverage_impl(cov, baseRate, adjRate)  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983650"> }</a></PRE>
      <div class="B_-_Body"><a name="2983652">The structure in this example is typical. First, figure out the date on which to look up rates. Next, look up a base rate factor in the demonstration system tables used for personal auto rating. Multiply those factors by various modifiers based on things like: </a></div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3145596">Chosen deductible</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3145597">Vehicle age</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3145598">Vehicle cost</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3145599">Diver’s record</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3145600">Loss history</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3145601">Underwriting company</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2992460">In this example, the last line of the method calls out to the common </a><span class="cv_-_computer_voice">rateVehicleCoverage_impl</span> function. That function sets the effective date span of the cost to be:</div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3145619">Start date = the start of the slice to rate </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3145620">End date = the start of the next slice date</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="3145621">The implementation looks like:</a></div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983654">private function rateVehicleCoverage_impl(cov : PersonalVehicleCov, baseRate : BigDecimal, </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2992498">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;adjRate : BigDecimal) : PersonalVehicleCovCostData {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983656">   var start = cov.SliceDate</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983657">   var end = getNextSliceDateAfter(start)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983658">   var cost = new PersonalVehicleCovCostData(start, end, cov.FixedId)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983659">   populateCostData(cost, baseRate, adjRate)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983660">   return cost</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983661"> }</a></PRE>
      <div class="B_-_Body"><a name="2983664">This method calls a standard </a><span class="cv_-_computer_voice">populateCostData</span> method that is common to both vehicle-level and line-level coverage costs. This method copies the rates into the cost, sets the term amount, and copies the standard columns into the actual columns:</div>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983666"> private function populateCostData(cost : CostData, baseRate : BigDecimal, adjRate : BigDecimal) {</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983667">   cost.NumDaysInRatedTerm = this.NumDaysInCoverageRatedTerm</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983668">   cost.StandardBaseRate = baseRate</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983669">   cost.StandardAdjRate = adjRate</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983670">   cost.Basis   = 1 // Assumes 1 vehicle year</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983671">   cost.StandardTermAmount = adjRate.setScale(RoundingLevel, RoundingMode.HALF_UP)</a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983672">   cost.copyStandardColumnsToActualColumns()  </a></PRE>
      <PRE class="CM_-_Code_Middle_Line"><a name="2983673"> }</a></PRE>
      <div class="B_-_Body"><a name="2983675">The end result of the </a><span class="cv_-_computer_voice">rateVehicleCoverage</span> call is a fully-populated <span class="cv_-_computer_voice">PersonalVehicleCovCostData</span>. The code can now add it to the list of <span class="cv_-_computer_voice">CostData</span> objects. </div>
      <div class="B_-_Body"><a name="2991937">The </a><span class="cv_-_computer_voice">AbstractRatingEngine</span> class might later merge this <span class="cv_-_computer_voice">CostData</span> with other adjacent <span class="cv_-_computer_voice">CostData</span> objects. Next, the <span class="cv_-_computer_voice">AbstractRatingEngine</span> prorates the cost. Lastly, the <span class="cv_-_computer_voice">AbstractRatingEngine</span> built-in methods converts the cost data object to a cost entity instance and persists it to the database.</div>
      <div class="H3_-_Heading_3_outer" style="margin-left: 36pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <h5 class="H3_-_Heading_3_inner" style="width: 18pt; white-space: nowrap"></h5>
            </td>
            <td width="100%">
              <h5 class="H3_-_Heading_3_inner"><a name="2991938">Rate Window Method for </a><span class="cvh_-_computer_voice_in_heading">PersonalAutoCovCostData</span></h5>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2983352">The </a><span class="cv_-_computer_voice">rateWindow</span> method in <span class="cv_-_computer_voice">PASysTableRatingEngine</span> rates the following: </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3144804">Multipolicy discounts</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3144805">Cancellation penalties</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="BI_-_Bullet_Item_outer" style="margin-left: 57pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="" role="presentation">
          <tr style="vertical-align: baseline">
            <td>
              <div class="BI_-_Bullet_Item_inner" style="width: 15pt; white-space: nowrap">
                <span class="bu_-_bullet">•	</span>
              </div>
            </td>
            <td width="100%">
              <div class="BI_-_Bullet_Item_inner"><a name="3144806">Taxes </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="B_-_Body"><a name="2992525">The multipolicy discount is notable because it rates essentially in slice mode, however just using the effective dates of the modifier itself. For each effective span, the discount sums the costs between that point in time and applies the discount to that period of time. </a></div>
      <div class="B_-_Body"><a name="2992599">The cancellation penalty simply applies a flat percentage to the sum of all the costs computed up to that point in time (including the discount costs). Finally, tax calculations apply a percentage to the sum of all costs (including the cancellation penalty).</a></div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>